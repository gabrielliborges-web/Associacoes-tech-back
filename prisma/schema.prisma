datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

/* ============================
   ENUMS GERAIS
============================ */

enum Theme {
  DARK
  LIGHT
}

enum Role {
  USER
  ADMIN
  SUPERADMIN
}

enum TipoMidia {
  FOTO
  VIDEO
}

/* ============================
   ENUMS FUTEBOL / ASSOCIAÇÃO
============================ */

enum Posicao {
  GOLEIRO
  ZAGUEIRO
  LATERAL
  VOLANTE
  MEIA
  ATACANTE
}

enum PernaDominante {
  DIREITA
  ESQUERDA
  AMBIDESTRO
}

enum TipoJogo {
  BABA
  AMISTOSO
  CAMPEONATO
  TREINO
}

enum TipoGol {
  NORMAL
  PENALTI
  FALTA
  CONTRA
  OUTRO
}

enum TipoCartao {
  AMARELO
  VERMELHO
}

enum LadoTime {
  A
  B
}

/* ============================
   TIPOS DE USUÁRIO NA ASSOCIAÇÃO
============================ */

enum PerfilAssociacao {
  ASSOCIADO
  DIRETOR
  TECNICO
  ADMINISTRADOR
}

/* ============================
   ENUMS FINANCEIROS / MENSALIDADES
============================ */

enum FormaPagamento {
  DINHEIRO
  PIX
  CREDITO
  DEBITO
  TRANSFERENCIA
  BOLETO
  OUTRO
}

enum StatusMensalidade {
  ABERTA
  PAGA
  ATRASADA
  ISENTA
  CANCELADA
}

/* ============================
   USUÁRIO (LOGIN + PERFIL)
============================ */

model Usuario {
  id              Int              @id @default(autoincrement())
  nome            String
  email           String           @unique
  senha           String
  avatarUrl       String?
  role            Role             @default(USER)
  theme           Theme?           @default(DARK)
  ativo           Boolean          @default(true)
  criadoEm        DateTime         @default(now())
  atualizadoEm    DateTime         @updatedAt

  // Associação (todo usuário pertence a uma)
  associacaoId     Int
  associacao       Associacao      @relation(fields: [associacaoId], references: [id])

  // Perfil dentro da associação
  perfilAssociacao PerfilAssociacao @default(ASSOCIADO)

  // Informações de jogador
  apelido            String?
  dataNascimento     DateTime?
  telefone           String?
  numeroCamisaPadrao Int?
  posicaoPreferida   Posicao?
  pernaDominante     PernaDominante?
  dataEntrada        DateTime?       @default(now())
  observacoes        String?

  // Relacionamentos esportivos
  presencas          PresencaJogo[]
  participacoes      JogadorJogo[]

   mensalidades MensalidadeAssociado[]

  @@index([associacaoId])
}

/* ============================
   ASSOCIAÇÃO / CLUBE
============================ */

model Associacao {
  id                  Int        @id @default(autoincrement())
  nome                String
  apelido             String?
  descricao           String?
  cidade              String?
  estado              String?
  logoUrl             String?
  ativa               Boolean    @default(true)
  criadoEm            DateTime   @default(now())
  atualizadoEm        DateTime   @updatedAt

  regrasInternas      String?
  horarioPadraoInicio String?
  horarioPadraoFim    String?
  tipoJogoPadrao      TipoJogo?  @default(BABA)

  usuarios     Usuario[]
  jogos        Jogo[]
  galerias     Galeria[]
  configMensalidade ConfigMensalidade?
  mensalidades      MensalidadeAssociado[]
}

/* ============================
   CONFIGURAÇÃO E MENSALIDADES
============================ */

model ConfigMensalidade {
  id           Int         @id @default(autoincrement())
  associacaoId Int         @unique
  valorPadrao  Decimal     @db.Decimal(10, 2)
  diaVencimento Int        @default(10)
  ativo        Boolean     @default(true)

  associacao   Associacao  @relation(fields: [associacaoId], references: [id])
  criadoEm     DateTime    @default(now())
  atualizadoEm DateTime    @updatedAt
}

model MensalidadeAssociado {
  id            Int              @id @default(autoincrement())
  associacaoId  Int
  usuarioId     Int
  ano           Int
  mes           Int
  valor         Decimal          @db.Decimal(10, 2)

  status        StatusMensalidade @default(ABERTA)
  vencimento    DateTime

  dataPagamento DateTime?
  formaPagamento FormaPagamento?
  comprovanteUrl String?
  observacoes    String?

  associacao    Associacao       @relation(fields: [associacaoId], references: [id])
  usuario       Usuario          @relation(fields: [usuarioId], references: [id])

  criadoEm      DateTime         @default(now())
  atualizadoEm  DateTime         @updatedAt

  @@unique([associacaoId, usuarioId, ano, mes])
  @@index([associacaoId, ano, mes])
  @@index([usuarioId, ano, mes])
}

/* ============================
   JOGOS / PARTIDAS
============================ */

model Jogo {
  id           Int            @id @default(autoincrement())
  associacaoId Int
  data         DateTime
  tipo         TipoJogo       @default(BABA)
  descricao    String?
  local        String?
  placarTimeA  Int            @default(0)
  placarTimeB  Int            @default(0)
  observacoes  String?
  criadoEm     DateTime       @default(now())
  atualizadoEm DateTime       @updatedAt

  associacao   Associacao     @relation(fields: [associacaoId], references: [id])

  times        TimeJogo[]
  gols         Gol[]
  cartoes      Cartao[]
  presencas    PresencaJogo[]
  midias       MidiaJogo[]

  @@index([associacaoId])
  @@index([data])
}

/* ============================
   TIMES, GOLS, CARTÕES, PRESENÇAS
============================ */

model TimeJogo {
  id           Int        @id @default(autoincrement())
  jogoId       Int
  nome         String
  corPrincipal String?
  lado         LadoTime

  jogo         Jogo       @relation(fields: [jogoId], references: [id])
  jogadores    JogadorJogo[]
  gols         Gol[]

  @@index([jogoId])
}

model JogadorJogo {
  id           Int         @id @default(autoincrement())
  timeJogoId   Int
  usuarioId    Int
  titular      Boolean     @default(true)
  numeroCamisa Int?
  posicao      Posicao?
  observacoes  String?

  time         TimeJogo    @relation(fields: [timeJogoId], references: [id])
  usuario      Usuario     @relation(fields: [usuarioId], references: [id])
  gols         Gol[]
  cartoes      Cartao[]

  @@index([timeJogoId])
  @@index([usuarioId])
}

model Gol {
  id            Int          @id @default(autoincrement())
  jogoId        Int
  timeJogoId    Int
  jogadorJogoId Int?
  minuto        Int?
  tipo          TipoGol      @default(NORMAL)

  jogo          Jogo         @relation(fields: [jogoId], references: [id])
  time          TimeJogo     @relation(fields: [timeJogoId], references: [id])
  jogador       JogadorJogo? @relation(fields: [jogadorJogoId], references: [id])

  criadoEm      DateTime     @default(now())
}

model Cartao {
  id            Int          @id @default(autoincrement())
  jogoId        Int
  jogadorJogoId Int
  minuto        Int?
  tipo          TipoCartao
  motivo        String?

  jogo          Jogo         @relation(fields: [jogoId], references: [id])
  jogador       JogadorJogo  @relation(fields: [jogadorJogoId], references: [id])

  criadoEm      DateTime     @default(now())
}

model PresencaJogo {
  id             Int        @id @default(autoincrement())
  jogoId         Int
  usuarioId      Int
  presente       Boolean    @default(true)
  chegouAtrasado Boolean?   @default(false)
  observacoes    String?

  jogo           Jogo       @relation(fields: [jogoId], references: [id])
  usuario        Usuario    @relation(fields: [usuarioId], references: [id])

  criadoEm       DateTime   @default(now())
  @@unique([jogoId, usuarioId])
}

model MidiaJogo {
  id        Int       @id @default(autoincrement())
  jogoId    Int
  url       String
  tipo      TipoMidia @default(FOTO)
  descricao String?
  criadoEm  DateTime  @default(now())

  jogo      Jogo      @relation(fields: [jogoId], references: [id])
}

model Galeria {
  id           Int        @id @default(autoincrement())
  associacaoId Int
  titulo       String
  descricao    String?
  dataEvento   DateTime?
  capaUrl      String?
  visivel      Boolean    @default(true)
  criadoEm     DateTime   @default(now())
  atualizadoEm DateTime   @updatedAt

  associacao   Associacao @relation(fields: [associacaoId], references: [id])
  midias       MidiaGaleria[]
}

model MidiaGaleria {
  id        Int       @id @default(autoincrement())
  galeriaId Int
  url       String
  tipo      TipoMidia @default(FOTO)
  descricao String?
  destaque  Boolean   @default(false)
  ordem     Int?
  criadoEm  DateTime  @default(now())

  galeria   Galeria   @relation(fields: [galeriaId], references: [id])
}
