datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

/* ============================
   ENUMS GERAIS
============================ */

enum Theme {
  DARK
  LIGHT
}

enum Role {
  USER
  ADMIN
  SUPERADMIN
}

enum TipoMidia {
  FOTO
  VIDEO
}

/* ============================
   ENUMS FUTEBOL / ASSOCIA칂츾O
============================ */

enum Posicao {
  GOLEIRO
  ZAGUEIRO
  LATERAL
  VOLANTE
  MEIA
  ATACANTE
}

enum PernaDominante {
  DIREITA
  ESQUERDA
  AMBIDESTRO
}

enum TipoJogo {
  BABA
  AMISTOSO
  CAMPEONATO
  TREINO
}

enum TipoGol {
  NORMAL
  PENALTI
  FALTA
  CONTRA
  OUTRO
}

enum TipoCartao {
  AMARELO
  VERMELHO
}

enum LadoTime {
  A
  B
}

enum PerfilAssociacao {
  SOCIO
  DIRETOR
  TECNICO
  ADMINISTRADOR
}

/* ============================
   AUTENTICA칂츾O / USU츼RIO
============================ */

model Usuario {
  id              Int              @id @default(autoincrement())
  nome            String
  email           String           @unique
  senha           String
  avatarUrl       String?
  role            Role             @default(USER)
  theme           Theme?           @default(DARK)
  ativo           Boolean          @default(true)
  criadoEm        DateTime         @default(now())
  atualizadoEm    DateTime         @updatedAt

  // Associa칞칚o "master"  qual este usu치rio pertence (obrigat칩rio)
  associacaoId     Int
  associacao       Associacao      @relation(fields: [associacaoId], references: [id])

  // Perfil do usu치rio dentro da associa칞칚o
  perfilAssociacao PerfilAssociacao @default(SOCIO)

  // Relacionamento opcional com um Associado (quando o jogador tem login)
  associado        Associado?       @relation("UsuarioAssociado")

  @@index([associacaoId])
}

model PasswordReset {
  id        String   @id @default(uuid())
  email     String   @unique
  code      String
  expiresAt DateTime
  used      Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

/* ============================
   ASSOCIA칂츾O / CLUBE
============================ */

model Associacao {
  id           Int           @id @default(autoincrement())
  nome         String
  apelido      String?
  descricao    String?
  cidade       String?
  estado       String?
  logoUrl      String?
  ativa        Boolean       @default(true)
  criadoEm     DateTime      @default(now())
  atualizadoEm DateTime      @updatedAt

  associados   Associado[]
  usuarios     Usuario[]
  jogos        Jogo[]
  galerias     Galeria[]     // 游녣 galeria geral de fotos/v칤deos
}

/* ============================
   ASSOCIADOS (JOGADORES / S칍CIOS)
============================ */

model Associado {
  id                 Int                @id @default(autoincrement())
  associacaoId       Int
  nome               String
  apelido            String?
  dataNascimento     DateTime?
  telefone           String?
  email              String?
  fotoUrl            String?
  numeroCamisaPadrao Int?
  posicaoPreferida   Posicao?
  pernaDominante     PernaDominante?
  dataEntrada        DateTime?          @default(now())
  ativo              Boolean            @default(true)
  observacoes        String?

  // Associa칞칚o a que pertence
  associacao         Associacao         @relation(fields: [associacaoId], references: [id])

  // Liga칞칚o opcional com o usu치rio (login na intranet)
  usuarioId          Int?               @unique
  usuario            Usuario?           @relation("UsuarioAssociado", fields: [usuarioId], references: [id])

  presencas          PresencaJogo[]
  participacoes      JogadorJogo[]

  @@index([associacaoId])
}

/* ============================
   JOGOS / PARTIDAS
============================ */

model Jogo {
  id           Int            @id @default(autoincrement())
  associacaoId Int
  data         DateTime
  tipo         TipoJogo       @default(BABA)
  descricao    String?
  local        String?
  placarTimeA  Int            @default(0)
  placarTimeB  Int            @default(0)
  observacoes  String?
  criadoEm     DateTime       @default(now())
  atualizadoEm DateTime       @updatedAt

  associacao   Associacao     @relation(fields: [associacaoId], references: [id])

  times        TimeJogo[]
  gols         Gol[]
  cartoes      Cartao[]
  presencas    PresencaJogo[]
  midias       MidiaJogo[]

  @@index([associacaoId])
  @@index([data])
}

/* ============================
   TIMES POR JOGO
============================ */

model TimeJogo {
  id           Int        @id @default(autoincrement())
  jogoId       Int
  nome         String     // Ex: "Time Verde", "Time Azul"
  corPrincipal String?    // Ex: "#16a34a"
  lado         LadoTime   // A ou B (p/ bater com placarTimeA / placarTimeB)

  jogo         Jogo       @relation(fields: [jogoId], references: [id])
  jogadores    JogadorJogo[]
  gols         Gol[]

  @@index([jogoId])
}

/* ============================
   JOGADOR EM UM JOGO
============================ */

model JogadorJogo {
  id           Int         @id @default(autoincrement())
  timeJogoId   Int
  associadoId  Int
  titular      Boolean     @default(true)
  numeroCamisa Int?
  posicao      Posicao?
  observacoes  String?

  time         TimeJogo    @relation(fields: [timeJogoId], references: [id])
  associado    Associado   @relation(fields: [associadoId], references: [id])
  gols         Gol[]
  cartoes      Cartao[]

  @@index([timeJogoId])
  @@index([associadoId])
}

/* ============================
   GOLS
============================ */

model Gol {
  id            Int          @id @default(autoincrement())
  jogoId        Int
  timeJogoId    Int
  jogadorJogoId Int?
  minuto        Int?
  tipo          TipoGol      @default(NORMAL)

  jogo          Jogo         @relation(fields: [jogoId], references: [id])
  time          TimeJogo     @relation(fields: [timeJogoId], references: [id])
  jogador       JogadorJogo? @relation(fields: [jogadorJogoId], references: [id])

  criadoEm      DateTime     @default(now())

  @@index([jogoId])
  @@index([timeJogoId])
  @@index([jogadorJogoId])
}

/* ============================
   CART칏ES
============================ */

model Cartao {
  id            Int          @id @default(autoincrement())
  jogoId        Int
  jogadorJogoId Int
  minuto        Int?
  tipo          TipoCartao
  motivo        String?

  jogo          Jogo         @relation(fields: [jogoId], references: [id])
  jogador       JogadorJogo  @relation(fields: [jogadorJogoId], references: [id])

  criadoEm      DateTime     @default(now())

  @@index([jogoId])
  @@index([jogadorJogoId])
}

/* ============================
   PRESEN칂A EM JOGO
============================ */

model PresencaJogo {
  id             Int        @id @default(autoincrement())
  jogoId         Int
  associadoId    Int
  presente       Boolean    @default(true)
  chegouAtrasado Boolean?   @default(false)
  observacoes    String?

  jogo           Jogo       @relation(fields: [jogoId], references: [id])
  associado      Associado  @relation(fields: [associadoId], references: [id])

  criadoEm       DateTime   @default(now())

  @@unique([jogoId, associadoId])
  @@index([jogoId])
  @@index([associadoId])
}

/* ============================
   MIDIAS (FOTOS / V칈DEOS) DO JOGO
============================ */

model MidiaJogo {
  id        Int       @id @default(autoincrement())
  jogoId    Int
  url       String     // onde a imagem/v칤deo est치 salvo
  tipo      TipoMidia  @default(FOTO)
  descricao String?
  criadoEm  DateTime   @default(now())

  jogo      Jogo       @relation(fields: [jogoId], references: [id])

  @@index([jogoId])
}

/* ============================
   GALERIAS GERAIS DA ASSOCIA칂츾O
============================ */

model Galeria {
  id           Int        @id @default(autoincrement())
  associacaoId Int
  titulo       String
  descricao    String?
  dataEvento   DateTime?
  capaUrl      String?
  visivel      Boolean    @default(true)
  criadoEm     DateTime   @default(now())
  atualizadoEm DateTime   @updatedAt

  associacao   Associacao @relation(fields: [associacaoId], references: [id])
  midias       MidiaGaleria[]

  @@index([associacaoId])
}

model MidiaGaleria {
  id        Int       @id @default(autoincrement())
  galeriaId Int
  url       String
  tipo      TipoMidia @default(FOTO)
  descricao String?
  destaque  Boolean   @default(false)
  ordem     Int?
  criadoEm  DateTime  @default(now())

  galeria   Galeria   @relation(fields: [galeriaId], references: [id])

  @@index([galeriaId])
}
