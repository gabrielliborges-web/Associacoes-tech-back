datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

/* ============================
   ENUMS GERAIS
============================ */

enum Theme {
  DARK
  LIGHT
}

enum Role {
  USER
  ADMIN
  SUPERADMIN
}

enum TipoMidia {
  FOTO
  VIDEO
}

/* ============================
   ENUMS FUTEBOL / ASSOCIA√á√ÉO
============================ */

enum Posicao {
  GOLEIRO
  ZAGUEIRO
  LATERAL
  VOLANTE
  MEIA
  ATACANTE
}

enum PernaDominante {
  DIREITA
  ESQUERDA
  AMBIDESTRO
}

enum TipoJogo {
  BABA
  AMISTOSO
  CAMPEONATO
  TREINO
}

enum TipoGol {
  NORMAL
  PENALTI
  FALTA
  CONTRA
  OUTRO
}

enum TipoCartao {
  AMARELO
  VERMELHO
}

enum LadoTime {
  A
  B
}

enum PerfilAssociacao {
  SOCIO
  DIRETOR
  TECNICO
  ADMINISTRADOR
}

/* ============================
   AUTENTICA√á√ÉO / USU√ÅRIO
============================ */

model Usuario {
  id           Int                @id @default(autoincrement())
  nome         String
  email        String             @unique
  senha        String
  avatarUrl    String?
  role         Role               @default(USER)
  theme        Theme?             @default(DARK)
  ativo        Boolean            @default(true)
  criadoEm     DateTime           @default(now())
  atualizadoEm DateTime           @updatedAt

  // Relacionamento opcional com um Associado (quando o jogador tem login)
  associado    Associado?         @relation("UsuarioAssociado")

  // Perfis do usu√°rio em uma ou mais associa√ß√µes
  associacoes  UsuarioAssociacao[]
}

model PasswordReset {
  id        String   @id @default(uuid())
  email     String   @unique
  code      String
  expiresAt DateTime
  used      Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

/* ============================
   ASSOCIA√á√ÉO / CLUBE
============================ */

model Associacao {
  id           Int                 @id @default(autoincrement())
  nome         String
  apelido      String?
  descricao    String?
  cidade       String?
  estado       String?
  logoUrl      String?
  ativa        Boolean             @default(true)
  criadoEm     DateTime            @default(now())
  atualizadoEm DateTime            @updatedAt

  associados   Associado[]
  usuarios     UsuarioAssociacao[]
  jogos        Jogo[]
}

/* ============================
   ASSOCIADOS (JOGADORES / S√ìCIOS)
============================ */

model Associado {
  id                 Int                @id @default(autoincrement())
  associacaoId       Int
  nome               String
  apelido            String?
  dataNascimento     DateTime?
  telefone           String?
  email              String?
  fotoUrl            String?
  numeroCamisaPadrao Int?
  posicaoPreferida   Posicao?
  pernaDominante     PernaDominante?
  dataEntrada        DateTime?          @default(now())
  ativo              Boolean            @default(true)
  observacoes        String?

  // Associa√ß√£o a que pertence
  associacao         Associacao         @relation(fields: [associacaoId], references: [id])

  // Liga√ß√£o opcional com o usu√°rio (login na intranet)
  usuarioId          Int?               @unique
  usuario            Usuario?           @relation("UsuarioAssociado", fields: [usuarioId], references: [id])

  presencas          PresencaJogo[]
  participacoes      JogadorJogo[]

  @@index([associacaoId])
}

/* ============================
   USU√ÅRIO x ASSOCIA√á√ÉO (PERFIS)
============================ */

model UsuarioAssociacao {
  id           Int              @id @default(autoincrement())
  usuarioId    Int
  associacaoId Int
  perfil       PerfilAssociacao @default(SOCIO)

  usuario      Usuario          @relation(fields: [usuarioId], references: [id])
  associacao   Associacao       @relation(fields: [associacaoId], references: [id])

  @@unique([usuarioId, associacaoId])
  @@index([associacaoId])
}

/* ============================
   JOGOS / PARTIDAS
============================ */

model Jogo {
  id           Int            @id @default(autoincrement())
  associacaoId Int
  data         DateTime
  tipo         TipoJogo       @default(BABA)
  descricao    String?
  local        String?
  placarTimeA  Int            @default(0)
  placarTimeB  Int            @default(0)
  observacoes  String?
  criadoEm     DateTime       @default(now())
  atualizadoEm DateTime       @updatedAt

  associacao   Associacao     @relation(fields: [associacaoId], references: [id])

  times        TimeJogo[]
  gols         Gol[]
  cartoes      Cartao[]
  presencas    PresencaJogo[]

  // üëâ ADICIONAR ESTA LINHA
  midias       MidiaJogo[]

  @@index([associacaoId])
  @@index([data])
}


/* ============================
   TIMES POR JOGO
============================ */

model TimeJogo {
  id           Int        @id @default(autoincrement())
  jogoId       Int
  nome         String          // Ex: "Time Azul", "Time Branco"
  corPrincipal String?         // Ex: "#1D4ED8"
  lado         LadoTime        // A ou B (p/ bater com placarTimeA / placarTimeB)

  jogo         Jogo       @relation(fields: [jogoId], references: [id])
  jogadores    JogadorJogo[]
  gols         Gol[]

  @@index([jogoId])
}

/* ============================
   JOGADOR EM UM JOGO
============================ */

model JogadorJogo {
  id           Int         @id @default(autoincrement())
  timeJogoId   Int
  associadoId  Int
  titular      Boolean     @default(true)
  numeroCamisa Int?
  posicao      Posicao?
  observacoes  String?

  time         TimeJogo    @relation(fields: [timeJogoId], references: [id])
  associado    Associado   @relation(fields: [associadoId], references: [id])
  gols         Gol[]
  cartoes      Cartao[]

  @@index([timeJogoId])
  @@index([associadoId])
}

/* ============================
   GOLS
============================ */

model Gol {
  id            Int          @id @default(autoincrement())
  jogoId        Int
  timeJogoId    Int
  jogadorJogoId Int?
  minuto        Int?
  tipo          TipoGol      @default(NORMAL)

  jogo          Jogo         @relation(fields: [jogoId], references: [id])
  time          TimeJogo     @relation(fields: [timeJogoId], references: [id])
  jogador       JogadorJogo? @relation(fields: [jogadorJogoId], references: [id])

  criadoEm      DateTime     @default(now())

  @@index([jogoId])
  @@index([timeJogoId])
  @@index([jogadorJogoId])
}

/* ============================
   CART√ïES
============================ */

model Cartao {
  id            Int          @id @default(autoincrement())
  jogoId        Int
  jogadorJogoId Int
  minuto        Int?
  tipo          TipoCartao
  motivo        String?

  jogo          Jogo         @relation(fields: [jogoId], references: [id])
  jogador       JogadorJogo  @relation(fields: [jogadorJogoId], references: [id])

  criadoEm      DateTime     @default(now())

  @@index([jogoId])
  @@index([jogadorJogoId])
}

/* ============================
   PRESEN√áA EM JOGO
============================ */

model PresencaJogo {
  id             Int        @id @default(autoincrement())
  jogoId         Int
  associadoId    Int
  presente       Boolean    @default(true)
  chegouAtrasado Boolean?   @default(false)
  observacoes    String?

  jogo           Jogo       @relation(fields: [jogoId], references: [id])
  associado      Associado  @relation(fields: [associadoId], references: [id])

  criadoEm       DateTime   @default(now())

  @@unique([jogoId, associadoId])
  @@index([jogoId])
  @@index([associadoId])
}




model MidiaJogo {
  id          Int        @id @default(autoincrement())
  jogoId      Int
  url         String     // onde a imagem/v√≠deo est√° salvo
  tipo        TipoMidia  @default(FOTO)
  descricao   String?
  criadoEm    DateTime   @default(now())

  jogo        Jogo       @relation(fields: [jogoId], references: [id])

  @@index([jogoId])
}
